/*! License information can be found in helper.js.LICENSE.txt */
(()=>{"use strict";function e(e){const{avatar:t}=window.mdpHelper;if(e){if("none"===t.user.type)return;const e=document.createElement("div");return e.classList.add("mdp-helper-visitor-avatar","mdp-helper-avatar"),e.innerHTML=""!==t.user.content?t.user.content:t.user.url?`<img src="${t.user.url}" alt="${t.user.alt}">`:"",e}{if("none"===t.bot.type)return;const e=document.createElement("div");return e.classList.add("mdp-helper-bot-avatar","mdp-helper-avatar"),e.innerHTML=""!==t.bot.content?t.bot.content:t.bot.url?`<img src="${t.bot.url}" alt="${t.bot.alt}">`:"",e}}function t(e,t=""){const n=document.createElement("button");return n.classList.add("mdp-bot-menu-button"),n.setAttribute("data-button-type",e),n.title=t,n.innerHTML=t,n}function n(e){const{botRespondDelay:t,botTypingAnimation:n,botTypingAnimationDelay:a,randomizeBotRespondDelay:o}=window.mdpHelper,s=parseFloat(t),r="on"===n?+a:0;if(o){return Math.floor(Math.random()*s)+r*e}return s+r*e}function a(e){if(void 0===e)return;const t=document.querySelector(".mdp-helper-chatbot-footer-form");t&&(e?t.classList.remove("mdp-helper-form-disabled"):t.classList.add("mdp-helper-form-disabled"))}function o(){const{stt:e}=window.mdpHelper;if(!e)return;if(!e.enabled)return;const t=document.querySelector(".mdp-helper-bot-button-recognize");if(!t)return;const n=function(){let e=null;if("SpeechRecognition"in window)e=new SpeechRecognition;else{if(!("webkitSpeechRecognition"in window)){const{translations:t}=window.mdpHelper;console.warn(t.recognitionNotSupported);return document.querySelector(".mdp-helper-form-with-recognize").classList.remove("mdp-helper-form-with-recognize"),e}e=new webkitSpeechRecognition}return e.lang=document.documentElement.lang,e.continuous=!1,e.interimResults=!1,e.maxAlternatives=1,e}();n&&(t.addEventListener("click",(()=>{t.disabled?n.stop():(t.disabled=!0,"true"===t.getAttribute("data-in-progress")?n.stop():n.start())})),function(e,t){e.addEventListener("start",(()=>{const e=new CustomEvent("helper-recognition-start");window.dispatchEvent(e),t.setAttribute("data-in-progress","true")})),e.addEventListener("end",(()=>{const e=new CustomEvent("helper-recognition-end");window.dispatchEvent(e),t.setAttribute("data-in-progress","false"),t.disabled=!1})),e.addEventListener("result",(e=>{const{resultIndex:t}=e,{transcript:n}=e.results[t][0];document.querySelector("#mdp-helper-input-messages-field").value=n.charAt(0).toUpperCase()+n.slice(1);const a=new CustomEvent("helper-recognition",{detail:{message:n}});window.dispatchEvent(a)})),e.addEventListener("error",(e=>{const{translations:n}=window.mdpHelper;console.warn(`${n.recognitionError}: ${e.error}`);const a=new CustomEvent("helper-recognition-error",{detail:{message:e.error}});window.dispatchEvent(a),t.setAttribute("data-in-progress","false"),t.disabled=!1}))}(n,t))}function s(e){if(void 0===e.detail.message||""===e.detail.message)return;const t=document.querySelector(".mdp-helper-mute-button");if(t&&"true"===t.getAttribute("data-mute"))return;const n=window.speechSynthesis;if(!n)return;const{tts:a}=window.mdpHelper,o=document.documentElement.lang;let s=new SpeechSynthesisUtterance;if(a.multilingual||""===a.voice){const e=n.getVoices().find((e=>e.lang===o));e?(s.voice=e,s.lang=document.documentElement.lang):(s.voice=n.getVoices().find((e=>e.lang.startsWith(o))),s.lang=s.voice.lang),s.voice||(""===a.voice?(s.voice=n.getVoices().find((e=>e.lang.startsWith("en-GB"))),s.lang=s.voice.lang):a.voice.split(",").forEach((e=>{null===s.voice&&(s.voice=n.getVoices().find((t=>t.name===e.trim())),s.lang=s.voice.lang)})))}else a.voice.split(",").forEach((e=>{if(e=e.split(";")[0],null===s.voice){const t=n.getVoices().find((t=>t.name===e.trim()));t&&(s.voice=t,s.lang=s.voice.lang)}}));s.text=e.detail.message,n.speak(s)}function r(){const e=window.speechSynthesis;e&&e.speaking&&e.cancel()}function d(){const e=document.querySelector("#mdp-helper-input-messages-field"),t=document.querySelector(".mdp-helper-send-message-button");e&&t&&(i(t,!e.value.length>0),e.addEventListener("input",(()=>{i(t,!e.value.length>0)})),window.addEventListener("helper-recognition-end",(()=>{i(t,!e.value.length>0)})))}function i(e,t){e&&(t?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled"))}function p(e){if(!e)return;const t=document.body;document.querySelector(".mdp-helper-hide-chat")?t.classList.remove("mdp-helper-full-size-mobile-body"):t.classList.add("mdp-helper-full-size-mobile-body")}function l(e,t){const n=(new Date).getTime();localStorage.setItem("mdpSetupQuestionTime",n+""),sessionStorage.setItem("mdpUserQuestion",e),localStorage.setItem("mdpUserQuestion",e),sessionStorage.setItem("mdpBotAnswer",t),localStorage.setItem("mdpBotAnswer",t)}function c(e){return/\S+@\S+\.\S+/.test(e)}const m="on"===mdpHelper.botLogs;let u=sessionStorage.getItem("mdpHelperSessionId"),g=localStorage.getItem("mdpHelperSessionId"),h=localStorage.getItem("mdpHelperLogId"),w=localStorage.getItem("mdpHelperLog");async function f(e){!function(e){u=e,g=e,sessionStorage.setItem("mdpHelperSessionId",e),localStorage.setItem("mdpHelperSessionId",e)}(e);const t=await function(){const e=new XMLHttpRequest,t=new FormData;return t.append("mdp_helper_nonce",mdpHelper.nonce),t.append("action","mdp_helper_create_new_log"),new Promise(((n,a)=>{e.open("POST",mdpHelper.endpoint,!0),e.onload=()=>n(e.responseText),e.onerror=()=>a(e.statusText),e.send(t)}))}();return JSON.parse(t).data}function b(e){e&&(w+=e,localStorage.setItem("mdpHelperLog",w))}async function _(e,t){m&&(e?b(`user: ${t};`):(b(`bot: ${t};`),await function(){if(!h||g!==u)return;const e=new XMLHttpRequest,t=new FormData;return t.append("mdp_helper_nonce",mdpHelper.nonce),t.append("action","mdp_helper_update_log"),t.append("mdp_helper_log_id",h),t.append("mdp_helper_log_text",w),new Promise(((n,a)=>{e.open("POST",mdpHelper.endpoint,!0),e.onload=()=>n(e.responseText),e.onerror=()=>a(e.statusText),e.send(t)}))}()))}let H=sessionStorage.getItem("mdpHelperBotSessionId"),S=localStorage.getItem("mdpHelperBotSessionId");function v(e){H=e,S=e,sessionStorage.setItem("mdpHelperBotSessionId",e),localStorage.setItem("mdpHelperBotSessionId",e)}async function y(e){const t=new XMLHttpRequest,n=new FormData;return n.append("mdp_helper_nonce",mdpHelper.nonce),n.append("action","mdp_helper_create_thread"),n.append("mdp_helper_session_id",e),new Promise(((e,a)=>{t.open("POST",mdpHelper.endpoint,!0),t.onload=()=>e(t.responseText),t.onerror=()=>a(t.statusText),t.send(n)}))}async function L(e){if(H||S)H!==S&&(await async function(e){if(!e)return;const t=new XMLHttpRequest,n=new FormData;return n.append("mdp_helper_nonce",mdpHelper.nonce),n.append("action","mdp_helper_delete_thread"),n.append("mdp_helper_session_id",e),new Promise(((e,a)=>{t.open("POST",mdpHelper.endpoint,!0),t.onload=()=>e(t.responseText),t.onerror=()=>a(t.statusText),t.send(n)}))}(S),v(e),await y(e));else{v(e);const t=await y(e);JSON.parse(t).data.created||(localStorage.removeItem("mdpHelperBotSessionId"),sessionStorage.removeItem("mdpHelperBotSessionId"))}}const T=async function(){const i=document.querySelector(".mdp-helper-box"),b=document.querySelector(".mdp-helper-chatbot-messages-container"),H=document.querySelector(".mdp-helper-messages-wrapper"),S="on"===mdpHelper.botTypingAnimation?+mdpHelper.botTypingAnimationDelay:0,v=parseFloat(mdpHelper.botRespondDelay),y=""!==mdpHelper.sendMessageAudio?new Audio(mdpHelper.sendMessageAudio):"",T=""!==mdpHelper.receiveMessageAudio?new Audio(mdpHelper.receiveMessageAudio):"",E="on"===mdpHelper.enabledGoogleAnalytics,q="on"===mdpHelper.limitUsersRequests,x=mdpHelper.enableMoreHelpMessage,C=mdpHelper.acceptanceCheckBox,I=mdpHelper.currentBotPersonalityType,k=mdpHelper.showMessagePreloader,M=mdpHelper.botRespondDelayEnabled,A=mdpHelper.fullSizeOnMobile,P=mdpHelper.faqCategoryIcon,O=mdpHelper.maxPopupHeight,B=mdpHelper.autoOpenPopup,D=parseFloat(mdpHelper.autoOpenPopupDelay),R=document.querySelector(".mdp-helper-user-data-acceptance-wrapper"),N=document.querySelector(".mdp-helper-user-data-acceptance");let $,J=localStorage.getItem("mdpAcceptedCollectData"),F=!1,U=!1;const{translations:X,botFeatures:Q,tts:z,stt:G}=window.mdpHelper;let V={},W={},j=!1,K=!1,Y=!1,Z=0,ee=0,te=0,ne="",ae=!0,oe=!1,se=!1;async function re(e){""!==e&&(e.pause(),e.currentTime=0,await e.play())}function de(){const{botMemory:e}=window.mdpHelper;if(!e)return"";const t=sessionStorage.getItem("mdpUserQuestion")&&sessionStorage.getItem("mdpUserQuestion").length>0,n=localStorage.getItem("mdpUserQuestion")&&localStorage.getItem("mdpUserQuestion").length>0;if(!t&&!n)return"";const a=t?sessionStorage.getItem("mdpUserQuestion"):localStorage.getItem("mdpUserQuestion"),o=t?sessionStorage.getItem("mdpBotAnswer"):localStorage.getItem("mdpBotAnswer"),s=JSON.parse(o);be(!0,a,!0),s&&s.link_widget_data?be(!1,o,!0,!0,s.link_widget_data):be(!1,s.message,!0)}function ie(){const e=X.botCommands;be(!1,`<p>${e.title}</p><p>1. <button class="mdp-helper-command" title="${e.return}">/return</button> - ${e.return}</p><p>2. <button class="mdp-helper-command" title="${e.info}">/info</button> - ${e.info}</p>`),window.addEventListener("helper-message-rendered",(function(e){e.detail.isBotCommands&&e.detail.element.addEventListener("click",(async function(e){document.querySelector("#mdp-helper-input-messages-field").value=e.target.textContent,d()}))})),Y=!0}function pe(){setTimeout((()=>{document.querySelectorAll(".mdp-bot-menu-button").forEach((e=>{e.addEventListener("click",(e=>{switch(e.target.dataset.buttonType){case"faq":r(),_e(),Ee();break;case"collectData":r(),_e(),async function(){const e=await ge();W=JSON.parse(e).data,J=localStorage.getItem("mdpAcceptedCollectData"),"localstorage"===C&&"confirmed"===J||"session"===C&&U||"none"===C?(F=!1,j=!0,be(!1,Object.values(W)[0].message)):(R.style.display="flex",F=!0,be(!1,mdpHelper.confirmationAcceptanceText))}();break;case"sendEmail":r(),_e(),async function(){K=!0;const e=await ue("","get_emails_ask_user_email");be(!1,JSON.parse(e).data)}();break;case"noMoreHelp":!async function(){const e=await ue("","general_exit"),t=JSON.parse(e).data,a=document.createElement("div");a.classList.add("mdp-bot-menu"),Te(a,!1),await be(!1,t),setTimeout((()=>{_e(),b.appendChild(a)}),n(te))}();break;case"moreHelp":!async function(){const e=await ue("","general_try_again"),t=JSON.parse(e).data;document.createElement("div").classList.add("mdp-bot-menu"),await be(!1,t),setTimeout((()=>{_e()}),n(te)),await le(!1),pe()}()}}))}))}),n(te))}async function le(e=!0){j=!1,F=!1,K=!1,Z=0,R&&(R.style.display="none");const a=await ue("","general",!0),o=JSON.parse(a);e&&await be(!1,o.data),(Q.includes("faq")||Q.includes("collect_data")||Q.includes("get_user_email"))&&setTimeout((()=>{b.appendChild(function(){const e=document.createElement("div");return e.classList.add("mdp-bot-menu"),mdpHelper.botFeatures.forEach((n=>{switch(n){case"faq":e.appendChild(t("faq",mdpHelper.faqButtonName));break;case"collect_data":e.appendChild(t("collectData",mdpHelper.collectDataButtonName));break;case"get_user_email":e.appendChild(t("sendEmail",mdpHelper.sendEmailButton))}})),e}())}),n(te))}async function ce(e){r(),e.classList.toggle("mdp-helper-hide-chat"),0===ee&&(de(),await le(),pe(),Ae(),ee++),function(){const e=document.querySelector(".mdp-helper-send-message-button");e&&(e.querySelector(".mdp-helper-send-message-button-caption")||(e.style.minWidth=e.offsetHeight+"px"))}()}function me(e){k&&!M&&(e.onloadstart=()=>{setTimeout((()=>{he()}),0)},e.onloadend=()=>{!function(){const e=document.querySelector(".mdp-helper-message-preloader");b.removeChild(e)}()})}function ue(e,t,n=!1){const a=new XMLHttpRequest,o=new FormData,s=new URL(mdpHelper.endpoint);return s.searchParams.set("action","mdp_helper_get_dialog_message"),s.searchParams.set("mdp_helper_nonce",mdpHelper.nonce),s.searchParams.set("mdp_helper_messages_type",e),s.searchParams.set("mdp_helper_message_menu",t),n&&(s.searchParams.set("mdp_helper_with_conditions","included"),s.searchParams.set("mdp_post_id",mdpHelper.currentPost)),new Promise(((e,t)=>{a.open("GET",s,!0),a.onload=()=>e(a.responseText),me(a),a.onerror=()=>t(a.statusText),a.send(o)}))}function ge(){const e=new XMLHttpRequest,t=new FormData,n=new URL(mdpHelper.endpoint);return n.searchParams.set("mdp_helper_nonce",mdpHelper.nonce),n.searchParams.set("action","mdp_helper_get_collect_data_messages"),new Promise(((a,o)=>{e.open("GET",n,!0),e.onload=()=>a(e.responseText),me(e),e.onerror=()=>o(e.statusText),e.send(t)}))}function he(){const t=document.createElement("div");t.classList.add("mdp-helper-bot-message-container","mdp-helper-message-container","mdp-helper-message-preloader");const n=e(!1),a=document.createElement("div");a.classList.add("mdp-helper-bot-message","mdp-helper-message","mdp-helper-message-preloader"),a.innerHTML="<span></span><span></span><span></span>",n&&t.appendChild(n),t.appendChild(a),b.appendChild(t)}function we(e){const t=document.createElement("div");t.innerHTML=e;const n=t.querySelector("video"),a=t.querySelector("iframe"),o=t.querySelector("audio");return!!(n||a||o)}function fe(e,t,n,a,o,s,d=!1,i={}){"on"!==mdpHelper.botTypingAnimation||"bot"!==o||s||"bot"!==o||we(a)?"visitor"===o?t.innerText=a:t.innerHTML=a:(se=!1,function(e,t){let n,a,o=0;!function s(){if(o>=e.length)return;if(se)return;if(a=e.slice(0,++o),a>e)return;t.innerHTML=a;let r=a.slice(-1);if("<"===r&&(n=!0),">"===r&&(n=!1),n)return s();setTimeout(s,S)}()}(a,t)),function(e,t,n){const{messageSignature:a}=window.mdpHelper;if(!a)return;if(!(a.nameEnabled||a.timestampEnabled||a.buttonsEnabled||a.copyBotTextButtonEnabled))return;const o=e?"bot":"visitor",s=document.createElement("div");if(s.classList.add("mdp-helper-message-signature"),s.classList.add(`mdp-helper-${o}-signature`),a.nameEnabled){const t=document.createElement("span");t.classList.add("mdp-helper-message-name"),t.innerHTML=e?a.botName:a.userName,s.appendChild(t)}if(a.timestampEnabled){const e=document.createElement("span");e.classList.add("mdp-helper-message-timestamp"),e.innerHTML=(new Date).toLocaleTimeString(document.documentElement.lang,{hour12:a.timestampFormat12,hour:"numeric",minute:"numeric"}),s.appendChild(e)}if(e){const e=document.createElement("button");e.classList.add("mdp-helper-main-menu-button"),e.addEventListener("click",(async()=>{await n(),r()})),window.mdpHelper.messageSignature.buttonsEnabled&&(e.title=mdpHelper.translations.botCommands.return,e.innerHTML=`${mdpHelper.returnButtonIcon}<span class="mdp-helper-main-menu-button-caption">${mdpHelper.translations.botCommands.return}</span>`,s.appendChild(e))}if(e){const e=document.createElement("button");e.classList.add("mdp-helper-main-menu-button"),e.addEventListener("click",(e=>{const t=e.target.closest(".mdp-helper-message-signature"),n=e.target.classList.contains("mdp-helper-main-menu-button-caption")?e.target:e.target.querySelector(".mdp-helper-main-menu-button-caption"),a=t.nextSibling.querySelector(".mdp-helper-bot-message").innerText;navigator.clipboard.writeText(a),n.innerText=mdpHelper.translations.botCommands.successfullyCopied,setTimeout((()=>{n.innerText=mdpHelper.translations.botCommands.copy}),3e3)})),window.mdpHelper.messageSignature.copyBotTextButtonEnabled&&(e.title=mdpHelper.translations.botCommands.copy,e.innerHTML=`${mdpHelper.copyBotTextButtonIcon}<span class="mdp-helper-main-menu-button-caption">${mdpHelper.translations.botCommands.copy}</span>`,s.appendChild(e))}t.appendChild(s)}("visitor"!==o,b,Ie),n&&e.appendChild(n),d?e.appendChild(function(e,t){const{translations:n}=window.mdpHelper,a=document.createElement("div");if(a.classList.add("mdp-helper-link-widget-container"),a.classList.add("mdp-helper-bot-message"),a.classList.add("mdp-helper-message"),e.thumbnail){const t=document.createElement("div");t.classList.add("mdp-helper-link-widget-post-thumbnail"),t.innerHTML+=JSON.parse(e.thumbnail),a.appendChild(t)}const o=document.createElement("div");o.classList.add("mdp-helper-link-widget-content");const s=document.createElement("h6");s.classList.add("mdp-helper-link-widget-post-title"),s.innerText=e.post_title;const r=document.createElement("p");r.classList.add("mdp-helper-link-widget-post-excerpt"),r.innerText=e.post_excerpt;const d=document.createElement("a");return d.classList.add("mdp-helper-link-widget-read-more"),d.setAttribute("href",t),d.target="_blank",d.innerText=n.readMoreText,o.appendChild(s),o.appendChild(r),o.appendChild(d),a.appendChild(o),a}(i,a)):e.appendChild(t),b.appendChild(e)}async function be(t,n,o=!1,s=!1,r={}){const d=t?"visitor":"bot",i="on"===mdpHelper.botMessagePreloader,p=document.createElement("div");p.classList.add(`mdp-helper-${d}-message-container`,"mdp-helper-message-container");const l=e(t),c=document.createElement("div");c.classList.add(`mdp-helper-${d}-message`,"mdp-helper-message"),n&&(s||(te=n.length),(!o||!t)&&i&&v>0&&setTimeout((()=>{he()}),0),setTimeout((async()=>{const e=document.querySelector(".mdp-helper-message-preloader");if(fe(p,c,l,n,d,o,s,r),(!o||!t)&&i&&v>0&&b.removeChild(e),t?await re(y):await re(T),z.enabled&&!t){const e=/<video[^>]*\sclass="wp-video-shortcode"[^>]*>[\s\S]*?<\/video>/g,t=s?`${X.learnMoreText} ${r.post_title}`:n.replace(e,(e=>e.replace(/<a[^>]*>.*?<\/a>/g,""))).replace(/<\/?[^>]+(>|$)/g,""),a=new CustomEvent("helper-speak",{detail:{message:t}});window.dispatchEvent(a)}t||Q.includes("ai")||a(K||j||F||Y);const H=new CustomEvent("helper-message-rendered",{detail:{element:p,message:n,isBot:!t,isBotCommands:Y,isDataCollecting:j,notConfirmedAcceptanceMenu:F,isSendingEmail:K}});window.dispatchEvent(H),await _(t,n),t&&!oe&&(await async function(e){m&&(m&&(w||localStorage.setItem("mdpHelperLog","")),g||u?g!==u&&(h=await f(e),localStorage.setItem("mdpHelperLogId",h)):(h=await f(e),localStorage.setItem("mdpHelperLogId",h)))}(ke(10)),oe=!0)}),t||o?0:v))}function _e(){const e=document.querySelectorAll(".mdp-bot-menu");e.length&&(b.removeChild(e[e.length-1]),r())}async function He(e=!1,t=1){ne="";const n=await function(e){const t=new XMLHttpRequest,n=new FormData,a=new URL(mdpHelper.endpoint);return a.searchParams.set("action","mdp_helper_get_faq_questions"),a.searchParams.set("page",e),a.searchParams.set("mdp_helper_nonce",mdpHelper.nonce),new Promise(((e,o)=>{t.open("GET",a,!0),t.onload=()=>e(t.responseText),t.onerror=()=>o(t.statusText),t.send(n)}))}(t),a=JSON.parse(n);ye(a.data.questions_data.questions,a.data.categories,e,!1,+a.data.questions_data.pages_count,t),await Le(e)}function Se(e,t,n,a,o){const s=document.createElement("button"),r=mdpHelper.translations.pagination;s.classList.add("mdp-faq-pagination-button",`mdp-faq-pagination-${t}-nav-button`),s.innerText="next"===t?r.next:r.prev,s.addEventListener("click",(async()=>{(n<a&&"next"===t||n>1&&"prev"===t)&&(_e(),"next"===t?o?await ve(ne,n+1):await He(!0,n+1):o?await ve(ne,n-1):await He(!0,n-1))})),e.appendChild(s)}async function ve(e,t=1){const n=await function(e,t){const n=new XMLHttpRequest,a=new FormData,o=new URL(mdpHelper.endpoint);return o.searchParams.set("action","mdp_helper_get_faq_questions_by_cat"),o.searchParams.set("mdp_helper_nonce",mdpHelper.nonce),o.searchParams.set("category",e),o.searchParams.set("page",t),new Promise(((e,t)=>{n.open("GET",o,!0),n.onload=()=>e(n.responseText),n.onerror=()=>t(n.statusText),n.send(a)}))}(e,t),a=JSON.parse(n);ye(a.data.questions,[],!0,!0,+a.data.pages_count,t),await Le(!0)}function ye(e,t=[],a=!1,o=!1,s=0,r=1){setTimeout((()=>{const n=document.createElement("div");n.classList.add("mdp-bot-menu"),function(e,t){e.forEach((e=>{const n=document.createElement("div");n.innerHTML=`\n                    <span>${e}</span>\n                    ${P?`<div class="mdp-bot-menu-icon">${P}</div>`:""}\n            `,n.classList.add("mdp-bot-menu-button","mdp-category-button"),n.setAttribute("data-category",e),t.appendChild(n)}))}(t,n),e.forEach((e=>{const t=document.createElement("button");t.innerHTML=e.question,t.classList.add("mdp-bot-menu-button","mdp-question-button"),t.setAttribute("data-response-index",e.index),n.appendChild(t)})),b.appendChild(n),"on"===mdpHelper.pagination&&s>1&&function(e,t,n,a=1){const o=document.createElement("div");o.classList.add("mdp-bot-menu-button","mdp-faq-pagination"),Se(o,"prev",a,t,n);const s=document.createElement("div");s.classList.add("mdp-faq-pagination-pages-container");for(let e=1;e<=t;e++){const t=document.createElement("button");t.classList.add("mdp-faq-pagination-button"),t.innerText=e,e===a&&t.classList.add("mdp-faq-pagination-active"),t.addEventListener("click",(async()=>{_e(),n?await ve(ne,e):await He(!0,e)})),s.appendChild(t)}o.appendChild(s),Se(o,"next",a,t,n),e.appendChild(o)}(n,s,o,r),o&&function(e){const t=document.createElement("div");t.classList.add("mdp-bot-menu-button","mdp-bot-return-to-faq-questions"),t.innerText=mdpHelper.translations.returnFaqButton,t.addEventListener("click",(async()=>{_e(),e.removeChild(t),await He(!0)})),e.appendChild(t)}(n),Te(n)}),n(te)*(a?0:1))}async function Le(e=!1){setTimeout((()=>{const e=document.querySelectorAll(".mdp-question-button"),t=document.querySelectorAll(".mdp-category-button");e.forEach((e=>{e.addEventListener("click",(async e=>{_e(),be(!0,e.target.innerText.trim());const t=await function(e){const t=new XMLHttpRequest,n=new FormData,a=new URL(mdpHelper.endpoint);return a.searchParams.set("action","mdp_helper_get_faq_response"),a.searchParams.set("mdp_helper_nonce",mdpHelper.nonce),a.searchParams.set("mdp_helper_question_index",e),new Promise(((e,o)=>{t.open("GET",a,!0),t.onload=()=>e(t.responseText),me(t),t.onerror=()=>o(t.statusText),t.send(n)}))}(e.target.dataset.responseIndex),a=JSON.parse(t);if(a.data.link_widget_data){be(!1,a.data.answer,!1,!0,a.data.link_widget_data);const e=JSON.stringify({message:a.data.answer,link_widget_data:a.data.link_widget_data});l(a.data.question,e)}else{be(!1,a.data.answer);const e=JSON.stringify({message:a.data.answer});l(a.data.question,e)}we(a.data.answer)&&(te=0),$=setTimeout((async()=>{x?await qe():await Ee()}),n(te)+1e3)}))})),t.forEach((e=>{e.addEventListener("click",(async e=>{_e(),ne=e.target.dataset.category||e.target.closest(".mdp-category-button").dataset.category,await ve(ne)}))}))}),(n(te)+500)*(e?0:1))}function Te(e,n=!0){const a=t("backToMenu",mdpHelper.translations.backToStartMenuButton);e.appendChild(a),a.addEventListener("click",(async()=>{_e(),V={},await le(n),pe()}))}async function Ee(){const e=await ue("","faq");be(!1,JSON.parse(e).data),await He()}async function qe(){const e=document.createElement("div"),a=await ue("","general_more_help_initial"),o=JSON.parse(a).data;await be(!1,o),e.classList.add("mdp-bot-menu"),setTimeout((()=>{_e(),e.appendChild(t("moreHelp",mdpHelper.moreHelpConfirmButtonText)),e.appendChild(t("noMoreHelp",mdpHelper.moreHelpDeclineButtonText)),b.appendChild(e)}),n(te)),pe()}async function xe(e){const t=await function(e){const t=new XMLHttpRequest,n=new FormData;return n.append("mdp_helper_nonce",mdpHelper.nonce),n.append("action","mdp_helper_bot_response"),n.append("visitor_message",e),n.append("mdp_helper_hash",localStorage.getItem("mdpHelperHash")),n.append("mdp_helper_session_id",localStorage.getItem("mdpHelperBotSessionId")),new Promise(((e,a)=>{t.open("POST",mdpHelper.endpoint,!0),t.onload=()=>e(t.responseText),me(t),t.onerror=()=>a(t.statusText),t.send(n)}))}(e),a=JSON.parse(t).data;a.link_widget_data?(be(!1,a.message,!1,!0,a.link_widget_data),l(e,JSON.stringify({message:a.message,link_widget_data:a.link_widget_data})),x&&setTimeout((async()=>{await qe()}),n(te))):(be(!1,a.message),l(e,JSON.stringify({message:a.message})),x&&setTimeout((async()=>{await qe()}),n(te)))}function Ce(e,t){switch(t.validation){case"email":c(e)?(ae=!0,Z++):(ae=!1,be(!1,t.validation_error));break;case"number":!function(e,t,n){const a=/^[0-9]+$/;return a.test(t)&&a.test(e)?+e<=+t:a.test(n)&&a.test(e)?+e>=+n:a.test(e)}(e,t.max_number,t.min_number)?(ae=!1,be(!1,t.validation_error)):(ae=!0,Z++);break;case"custom":n=e,a=t.validation_custom_regex,new RegExp(a).test(n)?(ae=!0,Z++):(ae=!1,be(!1,t.validation_error))}var n,a}async function Ie(){clearTimeout($),K=!1,j=!1,F=!1,se=!0,Z=0,_e(),V={},await le(),pe()}function ke(e){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a=0;for(;a<e;)t+=n.charAt(Math.floor(62*Math.random())),a+=1;return t}async function Me(){const e=document.querySelector("input.mdp-helper-input-messages-field");await re(y);const t=e.value;if(e.value="",""===t)return;if("/return"===t)return Y=!1,await le(),void pe();"/info"===t&&(Y=!1,r(),ie()),be(!0,t);const{botFeatures:a}=window.mdpHelper;if(K||j||F||!a.includes("ai")||(q&&!localStorage.getItem("mdpHelperHash")&&localStorage.setItem("mdpHelperHash",ke(20)),"assistant"===I&&await L(ke(10)),await xe(t)),j){const e=Object.values(W),a=Object.keys(W);if(V[a[Z]]=t,"none"===e[Z].validation?Z++:Ce(t,e[Z]),Z>a.length-1){const e=await function(e){const t=new XMLHttpRequest,n=new FormData;return n.append("mdp_helper_nonce",mdpHelper.nonce),n.append("action","mdp_helper_collect_user_data"),n.append("mdp_collected_data",JSON.stringify(e)),new Promise(((e,a)=>{t.open("POST",mdpHelper.endpoint,!0),t.onload=()=>e(t.responseText),me(t),t.onerror=()=>a(t.statusText),t.send(n)}))}(V);E&&"undefined"!=typeof gtag&&gtag("event","generate_lead",{event_label:"Helper collect data"}),be(!1,JSON.parse(e).data),ae=!0,Z=0,W={},j=!1,V={},setTimeout((async()=>{x?await qe():(await le(),await pe())}),n(te)+1e3)}else ae&&be(!1,e[Z].message)}if(F&&be(!1,mdpHelper.confirmationAcceptanceText),K){if(0===Z)if(c(t)){V.email=t,Z++;const e=await ue("","get_emails_ask_user_message");be(!1,JSON.parse(e).data)}else be(!1,mdpHelper.translations.incorrectEmailMessage);if(Z>0&&(V.message=t,Z++),Z>2){const e=await function(e){const t=new XMLHttpRequest,n=new FormData;return n.append("mdp_helper_nonce",mdpHelper.nonce),n.append("action","mdp_helper_send_user_email"),n.append("mdp_user_email",JSON.stringify(e)),new Promise(((e,a)=>{t.open("POST",mdpHelper.endpoint,!0),t.onload=()=>e(t.responseText),me(t),t.onerror=()=>a(t.statusText),t.send(n)}))}(V);be(!1,JSON.parse(e).data),V={},K=!1,Z=0,setTimeout((async()=>{x?await qe():(await le(),await pe())}),n(te)+1e3)}}}function Ae(){const{stt:e}=window.mdpHelper;document.querySelector(".mdp-helper-send-form").addEventListener("submit",(e=>{e.preventDefault(),Me().then()})),e.enabled&&e.autoSubmit&&window.addEventListener("helper-recognition",Me)}i&&(z.enabled&&(window.addEventListener("helper-speak",s,!1),window.speechSynthesis.onvoiceschanged=()=>{window.addEventListener("helper-speak",s,!1)},function(){const e="data-mute",t=document.querySelector(".mdp-helper-mute-button");if(!t)return;const{translations:n}=window.mdpHelper,a=document.createElement("b");t.getAttribute(e)||(t.setAttribute(e,"false"),a.innerHTML=n.on,t.appendChild(a)),t.addEventListener("click",(()=>{JSON.parse(t.getAttribute(e))?(t.setAttribute(e,"false"),a.innerHTML=n.on):(t.setAttribute(e,"true"),a.innerHTML=n.off,r())}))}()),G.enabled&&o(),m&&g!==u&&(w="",localStorage.setItem("mdpHelperLog",w),h="",localStorage.setItem("mdpHelperLogId",h)),i.style.display="block",function(e){const t=(new Date).getTime(),n=localStorage.getItem("mdpSetupQuestionTime");n&&t-n>60*e*60*1e3&&(localStorage.removeItem("mdpUserQuestion"),localStorage.removeItem("mdpBotAnswer"))}(+mdpHelper.localStorageHours),function(){const e=document.querySelector(".mdp-helper-messages-wrapper");if(!e)return;const t=document.querySelector(".mdp-helper-chatbot-messages-container");t&&e.addEventListener("scroll",(()=>{e.classList.contains("mdp-helper-wrapper-scrolled")||e.classList.add("mdp-helper-wrapper-scrolled");const n=document.querySelector(".mdp-helper-chatbot-messages");n&&(e.getBoundingClientRect().top>t.getBoundingClientRect().top?n.classList.add("mdp-helper-wrapper-gradient-top"):n.classList.remove("mdp-helper-wrapper-gradient-top"),e.getBoundingClientRect().bottom+1<t.getBoundingClientRect().bottom?n.classList.add("mdp-helper-wrapper-gradient-bottom"):n.classList.remove("mdp-helper-wrapper-gradient-bottom"))}))}(),d(),new ResizeObserver((function(){H.scrollTop=H.scrollHeight})).observe(b),await async function(){const e=await ge();W=JSON.parse(e).data,N&&N.addEventListener("change",(()=>{J=localStorage.getItem("mdpAcceptedCollectData"),N.checked&&(R.style.display="none","localstorage"!==C||J?"session"===C&&(U=!0):(localStorage.setItem("mdpAcceptedCollectData","confirmed"),J=localStorage.getItem("mdpAcceptedCollectData")),j=!0,F=!1,be(!1,Object.values(W)[0].message),N.checked=!1)}))}(),async function(){const e=document.querySelector(".mdp-helper-chatbot-box");if(function(){const e=document.querySelector(".mdp-helper-bot-commands");e&&e.addEventListener("click",(()=>{r(),ie()}))}(),"on"!==mdpHelper.openChatWithButton&&"on"===mdpHelper.openPopupWithoutButton)de(),await le(),pe(),Ae(),ee++;else{const t=document.querySelector("#mdp-helper-open-button"),n=document.querySelector(".mdp-helper-chatbot-close-button");n&&n.addEventListener("click",(()=>{r(),e.classList.add("mdp-helper-hide-chat"),p(A)})),document.addEventListener("click",(t=>{t.target.closest(".mdp-helper-chatbot-box, .mdp-bot-menu, .mdp-bot-menu-button")||t.target.closest("#mdp-helper-open-button")||(r(),e.classList.add("mdp-helper-hide-chat"),p(A))})),t&&t.addEventListener("click",(async()=>{await ce(e),p(A)})),window.addEventListener("click",(async t=>{t.target.classList.contains("mdp-helper-trigger")&&(t.preventDefault(),await ce(e),p(A))})),B&&setTimeout((async()=>{await ce(e)}),1e3*D)}a(Q.includes("ai"))}(),p(A),function(e){if(!e)return;const t=document.querySelector(".mdp-helper-open-button-wrapper"),n=document.querySelector(".mdp-helper-chatbot-box"),a=window.getComputedStyle(n),o=a.marginTop,s=a.marginBottom,r=t?`${t.clientHeight}px`:"0px";n.style.maxHeight=`calc(100vh - (${o} + ${s} + ${r}))`}(O))};"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",T)})();